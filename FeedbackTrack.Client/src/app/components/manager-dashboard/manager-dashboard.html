<div class="container">
    <div class="flex-between" style="margin-bottom: 20px;">
        <h2>Manager Dashboard - Team Oversight</h2>
        <div>
            <a routerLink="/reports" class="btn btn-primary">Generate Reports</a>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Team Feedback Review -->
        <div class="card">
            <h3>Team Feedback Review</h3>
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">Monitor the feedback received
                by your team members.</p>

            <div class="flex-center" style="justify-content: flex-start; gap: 10px; margin-bottom: 20px;">
                <select [(ngModel)]="targetUserId"
                    style="padding: 8px; flex: 1; border-radius: 4px; border: 1px solid #ddd;">
                    <option [ngValue]="null" disabled>Select Team Member...</option>
                    <option *ngFor="let user of users" [value]="user.id">{{ user.name }} ({{
                        user.department?.departmentName }})</option>
                </select>
                <button (click)="loadTeamFeedback()" class="btn btn-primary" [disabled]="isLoading || !targetUserId">
                    {{ isLoading ? 'Loading...' : 'Review Feedback' }}
                </button>
            </div>

            <div *ngIf="teamFeedback.length > 0">
                <div *ngFor="let msg of teamFeedback" style="border-bottom: 1px solid #eee; padding: 10px 0;">
                    <div style="font-weight: bold; color: var(--primary-color);">{{ msg.category }}</div>
                    <p style="margin: 5px 0;">"{{ msg.comments }}"</p>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                        From: {{ msg.isAnonymous ? 'Anonymous' : (msg.fromUser?.name || 'Unknown') }} â€¢ {{ msg.date |
                        date }}
                    </div>
                </div>
            </div>

            <div *ngIf="teamFeedback.length === 0 && !isLoading && targetUserId"
                style="color: var(--text-muted); padding: 20px; text-align: center;">
                No feedback items found for the selected team member.
            </div>
        </div>

        <!-- Team Engagement (Leaderboard) -->
        <div class="card">
            <h3>Team Engagement Leaderboard</h3>
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">Top performers based on
                appreciation points.</p>

            <div *ngIf="leaderboard.length === 0" style="color: var(--text-muted); text-align: center; padding: 20px;">
                Insufficient engagement data.
            </div>

            <table *ngIf="leaderboard.length > 0" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #eee;">
                        <th style="padding: 8px;">Rank</th>
                        <th style="padding: 8px;">Employee</th>
                        <th style="padding: 8px;">Points</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let entry of leaderboard; let i = index" style="border-bottom: 1px solid #eee;">
                        <td style="padding: 8px; font-weight: bold;">#{{ i + 1 }}</td>
                        <td style="padding: 8px;">{{ entry.user?.name || 'Employee' }}</td>
                        <td style="padding: 8px; font-weight: bold; color: var(--success-color);">{{ entry.totalPoints
                            }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>